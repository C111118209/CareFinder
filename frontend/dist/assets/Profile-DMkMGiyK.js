import{u as D,f as n,l as I,y as P,c as v,a as S,b as e,g as V,h as U,i as w,v as k,t as b,e as T,o as m}from"./index-t9rlBETP.js";import{N as z}from"./Navbar-CypzDj8e.js";const R={class:"bg-gray-50 min-h-screen"},q={class:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},F={class:"card mb-6"},E={class:"flex items-center space-x-6"},H={class:"flex-shrink-0"},L={class:"relative"},O=["src"],W={key:1,class:"w-24 h-24 rounded-full bg-gray-300 flex items-center justify-center border-4 border-gray-200"},G={class:"flex-1 space-y-4"},J=["value"],K={key:0,class:"text-red-600 text-sm bg-red-50 p-3 rounded-md border border-red-100"},Q={key:1,class:"text-green-600 text-sm bg-green-50 p-3 rounded-md border border-green-100"},X={class:"flex justify-end"},Y=["disabled"],Z={class:"card"},$={key:0,class:"text-red-600 text-sm bg-red-50 p-3 rounded-md border border-red-100"},ee={key:1,class:"text-green-600 text-sm bg-green-50 p-3 rounded-md border border-green-100"},ae={class:"flex justify-end"},te=["disabled"],oe={__name:"Profile",setup(se){const i=D(),j=n(null),l=n({email:"",nickname:"",avatar_url:"",role:""}),o=n({oldPassword:"",newPassword:"",confirmPassword:""}),h=n(""),r=n(""),u=n(""),c=n(""),y=n(""),p=n(!1),_=n(!1),N=s=>({user:"家屬",caregiver:"照護者",admin:"管理員"})[s]||s,A=async s=>{const a=s.target.files[0];if(a){if(!a.type.startsWith("image/")){r.value="請選擇圖片檔案",setTimeout(()=>{r.value=""},3e3);return}if(a.size>5*1024*1024){r.value="圖片大小不能超過5MB",setTimeout(()=>{r.value=""},3e3);return}try{const t=new FileReader;t.onload=async d=>{var x,M;const g=d.target.result;try{p.value=!0;const f=await P.updateUser(i.user.user_id,{avatar_url:g});l.value.avatar_url=f.avatar_url||g,h.value=g,i.updateUser(f),u.value="頭像更新成功",setTimeout(()=>{u.value=""},3e3)}catch(f){console.error("Failed to update avatar:",f),r.value=((M=(x=f.response)==null?void 0:x.data)==null?void 0:M.error)||f.message||"更新頭像失敗",setTimeout(()=>{r.value=""},3e3)}finally{p.value=!1}},t.onerror=()=>{r.value="處理圖片失敗",setTimeout(()=>{r.value=""},3e3)},t.readAsDataURL(a)}catch(t){console.error("Failed to process image:",t),r.value="處理圖片失敗",setTimeout(()=>{r.value=""},3e3)}}},B=async()=>{var s,a,t;r.value="",u.value="",p.value=!0;try{const d={},g=((s=i.user)==null?void 0:s.nickname)||"";if(l.value.nickname!==g&&(d.nickname=l.value.nickname),Object.keys(d).length===0){u.value="沒有變更需要儲存",setTimeout(()=>{u.value=""},3e3);return}const x=await P.updateUser(i.user.user_id,d);i.updateUser(x),l.value.nickname=x.nickname||"",u.value="個人資訊更新成功",setTimeout(()=>{u.value=""},3e3)}catch(d){r.value=((t=(a=d.response)==null?void 0:a.data)==null?void 0:t.error)||d.message||"更新失敗",setTimeout(()=>{r.value=""},3e3)}finally{p.value=!1}},C=async()=>{var s,a;if(c.value="",y.value="",o.value.newPassword!==o.value.confirmPassword){c.value="新密碼與確認密碼不一致";return}if(o.value.newPassword.length<6){c.value="新密碼長度至少需要6個字元";return}_.value=!0;try{await P.updatePassword(i.user.user_id,o.value.oldPassword,o.value.newPassword),y.value="密碼修改成功",o.value={oldPassword:"",newPassword:"",confirmPassword:""},setTimeout(()=>{y.value=""},3e3)}catch(t){c.value=((a=(s=t.response)==null?void 0:s.data)==null?void 0:a.error)||t.message||"修改密碼失敗"}finally{_.value=!1}};return I(async()=>{try{const s=await P.getCurrentUser();l.value={email:s.email||"",nickname:s.nickname||"",avatar_url:s.avatar_url||"",role:s.role||""},s.avatar_url&&(h.value=s.avatar_url),i.updateUser(s)}catch{r.value="載入資料失敗",setTimeout(()=>{r.value=""},3e3)}}),(s,a)=>(m(),v("div",null,[S(z),e("div",R,[e("div",q,[a[15]||(a[15]=e("h2",{class:"text-3xl font-bold mb-6 text-gray-800"},"個人資訊",-1)),e("div",F,[a[10]||(a[10]=e("h3",{class:"text-xl font-semibold mb-4"},"基本資訊",-1)),e("form",{onSubmit:V(B,["prevent"]),class:"space-y-6"},[e("div",E,[e("div",H,[e("div",L,[h.value||l.value.avatar_url?(m(),v("img",{key:0,src:h.value||l.value.avatar_url,alt:"頭像",class:"w-24 h-24 rounded-full object-cover border-4 border-gray-200"},null,8,O)):(m(),v("div",W,[...a[5]||(a[5]=[e("svg",{class:"w-12 h-12 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})],-1)])])),a[6]||(a[6]=e("label",{for:"avatarInput",class:"absolute bottom-0 right-0 bg-primary-600 text-white rounded-full p-2 cursor-pointer hover:bg-primary-700 transition-colors",title:"上傳頭像"},[e("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"}),e("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 13a3 3 0 11-6 0 3 3 0 016 0z"})])],-1)),e("input",{ref_key:"avatarInputRef",ref:j,type:"file",id:"avatarInput",accept:"image/*",class:"hidden",onChange:A},null,544)])]),e("div",G,[e("div",null,[a[7]||(a[7]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"暱稱",-1)),w(e("input",{"onUpdate:modelValue":a[0]||(a[0]=t=>l.value.nickname=t),type:"text",class:"input-field",placeholder:"請輸入您的暱稱"},null,512),[[k,l.value.nickname]])]),e("div",null,[a[8]||(a[8]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"電子郵件",-1)),w(e("input",{"onUpdate:modelValue":a[1]||(a[1]=t=>l.value.email=t),type:"email",class:"input-field bg-gray-100",readonly:"",placeholder:"電子郵件"},null,512),[[k,l.value.email]])]),e("div",null,[a[9]||(a[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"角色",-1)),e("input",{value:N(l.value.role),type:"text",class:"input-field bg-gray-100",readonly:""},null,8,J)])])]),r.value?(m(),v("div",K,b(r.value),1)):U("",!0),u.value?(m(),v("div",Q,b(u.value),1)):U("",!0),e("div",X,[e("button",{type:"submit",disabled:p.value,class:"btn-primary"},b(p.value?"儲存中...":"儲存變更"),9,Y)])],32)]),e("div",Z,[a[14]||(a[14]=e("h3",{class:"text-xl font-semibold mb-4"},"修改密碼",-1)),e("form",{onSubmit:V(C,["prevent"]),class:"space-y-6"},[e("div",null,[a[11]||(a[11]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[T(" 目前密碼 "),e("span",{class:"text-red-500"},"*")],-1)),w(e("input",{"onUpdate:modelValue":a[2]||(a[2]=t=>o.value.oldPassword=t),type:"password",required:"",class:"input-field",placeholder:"請輸入目前密碼"},null,512),[[k,o.value.oldPassword]])]),e("div",null,[a[12]||(a[12]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[T(" 新密碼 "),e("span",{class:"text-red-500"},"*")],-1)),w(e("input",{"onUpdate:modelValue":a[3]||(a[3]=t=>o.value.newPassword=t),type:"password",required:"",class:"input-field",placeholder:"請輸入新密碼（至少6個字元）",minlength:"6"},null,512),[[k,o.value.newPassword]])]),e("div",null,[a[13]||(a[13]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},[T(" 確認新密碼 "),e("span",{class:"text-red-500"},"*")],-1)),w(e("input",{"onUpdate:modelValue":a[4]||(a[4]=t=>o.value.confirmPassword=t),type:"password",required:"",class:"input-field",placeholder:"請再次輸入新密碼"},null,512),[[k,o.value.confirmPassword]])]),c.value?(m(),v("div",$,b(c.value),1)):U("",!0),y.value?(m(),v("div",ee,b(y.value),1)):U("",!0),e("div",ae,[e("button",{type:"submit",disabled:_.value,class:"btn-primary"},b(_.value?"處理中...":"修改密碼"),9,te)])],32)])])])]))}};export{oe as default};
