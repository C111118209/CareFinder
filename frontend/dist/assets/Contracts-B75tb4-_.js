import{u as Y,f as h,l as z,c as a,a as A,b as n,F as B,p as I,q as m,j as L,o,h as c,t as i,x as j,e as d,n as x,z as F}from"./index-t9rlBETP.js";import{N as P}from"./Navbar-CypzDj8e.js";const q={class:"bg-gray-50 min-h-screen"},W={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},G={key:0,class:"text-center py-10"},H={key:1,class:"text-center py-8 text-gray-600"},J={key:2,class:"space-y-4"},K={class:"flex flex-col md:flex-row justify-between items-start gap-4"},O={class:"flex-1 w-full"},Q={class:"flex items-center space-x-4 mb-4"},X={class:"text-xl font-semibold text-gray-800"},Z={key:0,class:"text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded"},ee={class:"grid md:grid-cols-2 gap-4 text-gray-700 mb-4"},te={class:"border-t pt-4 mt-4"},se={class:"grid md:grid-cols-2 gap-6"},ne={class:"bg-blue-50 p-4 rounded-lg"},re={class:"text-sm"},ae={class:"text-sm"},oe=["onClick"],ie={class:"bg-green-50 p-4 rounded-lg"},le={class:"text-sm"},de={class:"text-sm"},ce=["onClick"],ue={class:"mt-4"},me=["onClick"],pe={class:"flex flex-row md:flex-col gap-2 mt-2 md:mt-0 w-full md:w-auto"},ge=["onClick"],ve=["onClick"],xe=["onClick"],_e=["onClick"],fe={__name:"Contracts",setup(be){const _=L(),p=Y(),g=h([]),v=h(!1),b=s=>{if(!s)return"無資料";const e=new Date(s);return isNaN(e.getTime())?"格式錯誤":e.toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit"})},C=s=>({pending:"待確認",active:"進行中",completed:"已完成",canceled:"已取消"})[s]||s,k=s=>{const e=s.Caregiver||s.caregiver||{};return e.nickname||e.email||"未提供"},D=s=>(s.Caregiver||s.caregiver||{}).email||"未提供",N=s=>{const e=s.User||s.user||{};return e.nickname||e.email||"未提供"},$=s=>(s.User||s.user||{}).email||"未提供",M=(s,e)=>{const t=new Date(s),r=new Date(e),l=Math.abs(r-t);return Math.ceil(l/(1e3*60*60*24))||0},U=s=>{const e=new Date(s),r=Math.ceil((e-new Date)/(1e3*60*60*24));return r<=30&&r>=0},T=s=>{_.push(`/contract/${s}`)},y=(s,e)=>{_.push(`/contract/${s}?view=${e}`)},E=async s=>{var e,t;if(confirm("確定要接受這個合約嗎？"))try{await m.acceptContract(s),alert("合約已接受！"),u()}catch(r){alert("操作失敗："+(((t=(e=r.response)==null?void 0:e.data)==null?void 0:t.error)||r.message))}},R=async s=>{var e,t;if(confirm("確定要標記服務為已完成嗎？"))try{await m.completeContract(s),alert("服務已標記為完成！"),u()}catch(r){alert("操作失敗："+(((t=(e=r.response)==null?void 0:e.data)==null?void 0:t.error)||r.message))}},S=async s=>{var t,r;const e=prompt("請輸入續約結束日期 (YYYY-MM-DD):");if(e)try{await m.renewContract(s,e),alert("續約已發起！"),u()}catch(l){alert("續約失敗："+(((r=(t=l.response)==null?void 0:t.data)==null?void 0:r.error)||l.message))}},V=async(s,e)=>{var l,w;const t=prompt("請輸入評分 (1-5):");if(!t||t<1||t>5){alert("評分必須在 1-5 之間");return}const r=prompt("請輸入評價留言（可選）:")||"";try{await F.createReview({contract_id:s,caregiver_id:e,rating:parseInt(t),comment:r}),alert("評價已提交！"),u()}catch(f){alert("提交評價失敗："+(((w=(l=f.response)==null?void 0:l.data)==null?void 0:w.error)||f.message))}},u=async()=>{var s,e;v.value=!0;try{g.value=await m.getContracts()}catch(t){console.error("Load contracts error:",t),alert("載入失敗："+(((e=(s=t.response)==null?void 0:s.data)==null?void 0:e.error)||t.message))}finally{v.value=!1}};return z(()=>{u()}),(s,e)=>(o(),a("div",null,[A(P),n("div",q,[n("div",W,[e[10]||(e[10]=n("h2",{class:"text-3xl font-bold mb-6 text-gray-800"},"我的合約",-1)),v.value?(o(),a("div",G,[...e[0]||(e[0]=[n("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"},null,-1),n("p",{class:"mt-4 text-gray-600"},"載入中...",-1)])])):g.value.length===0?(o(),a("div",H," 目前沒有合約 ")):(o(),a("div",J,[(o(!0),a(B,null,I(g.value,t=>(o(),a("div",{key:t.contract_id,class:"bg-white p-6 rounded-lg shadow-md border border-gray-200"},[n("div",K,[n("div",O,[n("div",Q,[n("h3",X,"合約 #"+i(t.contract_id),1),n("span",{class:j([{"bg-yellow-100 text-yellow-800":t.status==="pending","bg-green-100 text-green-800":t.status==="active","bg-blue-100 text-blue-800":t.status==="completed","bg-red-100 text-red-800":t.status==="canceled"},"px-3 py-1 rounded-full text-sm font-medium"])},i(C(t.status)),3),t.is_renewal?(o(),a("span",Z," 續約 ")):c("",!0)]),n("div",ee,[n("div",null,[n("p",null,[e[1]||(e[1]=n("span",{class:"font-medium"},"開始日期：",-1)),d(i(b(t.start_date)),1)]),n("p",null,[e[2]||(e[2]=n("span",{class:"font-medium"},"結束日期：",-1)),d(i(b(t.end_date)),1)])]),n("div",null,[n("p",null,[e[3]||(e[3]=n("span",{class:"font-medium"},"合約期間：",-1)),d(i(M(t.start_date,t.end_date))+" 天",1)])])]),n("div",te,[n("div",se,[n("div",ne,[e[6]||(e[6]=n("h4",{class:"font-semibold text-blue-800 mb-2"},"照護者資訊",-1)),n("p",re,[e[4]||(e[4]=n("span",{class:"font-medium"},"姓名：",-1)),d(i(k(t)),1)]),n("p",ae,[e[5]||(e[5]=n("span",{class:"font-medium"},"電子郵件：",-1)),d(i(D(t)),1)]),t.caregiver_id?(o(),a("button",{key:0,onClick:r=>y(t.contract_id,"caregiver"),class:"mt-2 text-sm text-blue-600 hover:text-blue-800 underline"}," 查看詳細資料 ",8,oe)):c("",!0)]),n("div",ie,[e[9]||(e[9]=n("h4",{class:"font-semibold text-green-800 mb-2"},"家屬資訊",-1)),n("p",le,[e[7]||(e[7]=n("span",{class:"font-medium"},"姓名：",-1)),d(i(N(t)),1)]),n("p",de,[e[8]||(e[8]=n("span",{class:"font-medium"},"電子郵件：",-1)),d(i($(t)),1)]),n("button",{onClick:r=>y(t.contract_id,"user"),class:"mt-2 text-sm text-green-600 hover:text-green-800 underline"}," 查看詳細資料 ",8,ce)])])]),n("div",ue,[n("button",{onClick:r=>T(t.contract_id),class:"text-sm text-blue-600 hover:text-blue-800 underline font-medium"}," 查看完整合約詳情 → ",8,me)])]),n("div",pe,[t.status==="pending"&&x(p).isCaregiver?(o(),a("button",{key:0,onClick:r=>E(t.contract_id),class:"bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition whitespace-nowrap"}," 接受合約 ",8,ge)):c("",!0),t.status==="active"?(o(),a("button",{key:1,onClick:r=>R(t.contract_id),class:"bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition whitespace-nowrap"}," 完成服務 ",8,ve)):c("",!0),t.status==="completed"&&x(p).isUser?(o(),a("button",{key:2,onClick:r=>V(t.contract_id,t.caregiver_id),class:"bg-yellow-500 text-white px-4 py-2 rounded hover:bg-yellow-600 transition whitespace-nowrap"}," 評價 ",8,xe)):c("",!0),t.status==="active"&&x(p).isUser&&U(t.end_date)?(o(),a("button",{key:3,onClick:r=>S(t.contract_id),class:"bg-gray-200 text-gray-800 px-4 py-2 rounded hover:bg-gray-300 transition whitespace-nowrap"}," 續約 ",8,_e)):c("",!0)])])]))),128))]))])])]))}};export{fe as default};
