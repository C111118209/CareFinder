import{f as p,l as mt,c as o,a as vt,b as t,h as g,F as w,p as k,t as a,D as u,o as r,x as m,e as T}from"./index-t9rlBETP.js";import{N as _t}from"./Navbar-CypzDj8e.js";const bt={class:"bg-gray-50 min-h-screen"},ht={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8"},ft={class:"mb-6 flex space-x-2 border-b border-gray-200"},wt=["onClick"],kt={key:0,class:"space-y-6"},Ct={key:0,class:"text-center py-8"},Lt={key:1,class:"grid md:grid-cols-2 lg:grid-cols-3 gap-6"},$t={class:"card bg-blue-50"},St={class:"text-3xl font-bold text-blue-600 mb-1"},jt={class:"text-sm text-gray-600"},Mt={class:"mt-2"},Dt={class:"card bg-green-50"},At={class:"text-3xl font-bold text-green-600 mb-1"},It={class:"text-sm text-gray-600"},Nt={class:"card bg-purple-50"},Tt={class:"text-3xl font-bold text-purple-600 mb-1"},Bt={class:"text-sm text-gray-600"},Vt={class:"card bg-yellow-50"},Wt={class:"text-3xl font-bold text-yellow-600 mb-1"},Ft={class:"text-sm text-gray-600"},Rt={class:"card bg-indigo-50"},zt={class:"text-3xl font-bold text-indigo-600 mb-1"},Et={class:"text-sm text-gray-600"},Pt={key:1,class:"space-y-6"},Ut={key:0,class:"text-center py-8"},Ot={key:1,class:"card overflow-x-auto"},qt={class:"min-w-full divide-y divide-gray-200"},Gt={class:"bg-white divide-y divide-gray-200"},Ht={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Jt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Kt={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Qt={class:"px-6 py-4 whitespace-nowrap text-sm"},Xt={class:"px-6 py-4 whitespace-nowrap text-sm"},Yt={class:"px-6 py-4 whitespace-nowrap text-sm"},Zt=["onClick"],te={key:1,class:"text-gray-400"},ee={key:2,class:"space-y-6"},se={key:0,class:"text-center py-8"},ae={key:1,class:"card overflow-x-auto"},le={class:"min-w-full divide-y divide-gray-200"},oe={class:"bg-white divide-y divide-gray-200"},re={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},ne={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},ie={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},de={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},ce={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},pe={class:"px-6 py-4 whitespace-nowrap text-sm"},xe={class:"px-6 py-4 whitespace-nowrap text-sm"},ue=["onClick"],ye={key:3,class:"space-y-6"},ge={key:0,class:"text-center py-8"},me={key:1,class:"card overflow-x-auto"},ve={class:"min-w-full divide-y divide-gray-200"},_e={class:"bg-white divide-y divide-gray-200"},be={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},he={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},fe={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},we={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},ke={class:"px-6 py-4 whitespace-nowrap text-sm text-gray-900"},Ce={class:"px-6 py-4 whitespace-nowrap text-sm"},Le={class:"px-6 py-4 whitespace-nowrap text-sm"},$e=["onChange"],Se=["selected"],je=["selected"],Me=["selected"],De=["selected"],Ae={key:4,class:"space-y-6"},Ie={class:"flex justify-between items-center"},Ne={class:"flex space-x-2"},Te={key:0,class:"text-center py-8"},Be={key:1,class:"text-center py-8 text-gray-600"},Ve={key:2,class:"space-y-4"},We={class:"flex justify-between items-start"},Fe={class:"flex-1"},Re={class:"flex items-center space-x-3 mb-2"},ze={class:"text-lg font-semibold text-gray-800"},Ee={class:"text-gray-600 space-y-1 text-sm"},Pe={key:0},Ue=["onClick"],Oe={key:0,class:"flex space-x-2 ml-4"},qe=["onClick"],Ge=["onClick"],Xe={__name:"AdminDashboard",setup(He){const ot=[{id:"statistics",label:"統計報告"},{id:"users",label:"用戶管理"},{id:"caregivers",label:"照護者管理"},{id:"contracts",label:"合約管理"},{id:"licenses",label:"證照審核"}],v=p("statistics"),n=p(null),B=p([]),V=p([]),W=p([]),S=p([]),j=p(!1),M=p(!1),D=p(!1),A=p(!1),I=p(!1),C=l=>l?new Date(l).toLocaleDateString("zh-TW",{year:"numeric",month:"2-digit",day:"2-digit"}):"無資料",rt=l=>({admin:"管理員",caregiver:"照護者",user:"使用者"})[l]||l,nt=l=>({pending:"待處理",active:"進行中",completed:"已完成",canceled:"已取消"})[l]||l,it=l=>({pending:"bg-yellow-100 text-yellow-800",active:"bg-green-100 text-green-800",completed:"bg-blue-100 text-blue-800",canceled:"bg-red-100 text-red-800"})[l]||"bg-gray-100 text-gray-800",dt=l=>({pending:"待審核",approved:"已通過",rejected:"已拒絕"})[l]||l,ct=l=>({pending:"bg-yellow-100 text-yellow-800",approved:"bg-green-100 text-green-800",rejected:"bg-red-100 text-red-800"})[l]||"bg-gray-100 text-gray-800",pt=async()=>{j.value=!0;try{n.value=await u.getStatistics()}catch(l){console.error("Load statistics error:",l),alert("載入統計資料失敗")}finally{j.value=!1}},F=async()=>{M.value=!0;try{B.value=await u.getAllUsers()}catch(l){console.error("Load users error:",l),alert("載入用戶列表失敗")}finally{M.value=!1}},R=async()=>{D.value=!0;try{V.value=await u.getAllCaregivers()}catch(l){console.error("Load caregivers error:",l),alert("載入照護者列表失敗")}finally{D.value=!1}},z=async()=>{A.value=!0;try{W.value=await u.getAllContracts()}catch(l){console.error("Load contracts error:",l),alert("載入合約列表失敗")}finally{A.value=!1}},N=async(l="pending")=>{I.value=!0;try{S.value=l==="pending"?await u.getPendingLicenses():await u.getAllLicenses()}catch(e){console.error("Load licenses error:",e),alert("載入證照列表失敗")}finally{I.value=!1}},xt=async(l,e)=>{var i,d;if(confirm(`確定要${e?"啟用":"停用"}此用戶嗎？`))try{await u.toggleUserStatus(l,e),alert("用戶狀態已更新"),F()}catch(c){alert("更新失敗："+(((d=(i=c.response)==null?void 0:i.data)==null?void 0:d.error)||c.message))}},ut=async(l,e)=>{var i,d;if(confirm(`確定要${e?"啟用":"停用"}此照護者嗎？`))try{await u.updateCaregiverStatus(l,e),alert("照護者狀態已更新"),R()}catch(c){alert("更新失敗："+(((d=(i=c.response)==null?void 0:i.data)==null?void 0:d.error)||c.message))}},yt=async(l,e)=>{var i,d;try{await u.updateContractStatus(l,e),alert("合約狀態已更新"),z()}catch(c){alert("更新失敗："+(((d=(i=c.response)==null?void 0:i.data)==null?void 0:d.error)||c.message))}},E=async(l,e)=>{var d,c;const i=e==="approved"?"通過":"拒絕";if(confirm(`確定要${i}此證照嗎？`))try{await u.reviewLicense(l,e),alert(`證照已${i}`),N("pending")}catch(_){alert("審核失敗："+(((c=(d=_.response)==null?void 0:d.data)==null?void 0:c.error)||_.message))}},gt=async l=>{if(!l)return;const e=localStorage.getItem("token");if(!e){alert("請先登入");return}try{let i=l;const d="/api/v1";if(l.startsWith("/uploads/licenses/")){const $=l.replace("/uploads/licenses/","");i=`${d}/caregivers/licenses/image/${$}`}else l.startsWith("http")||(l.startsWith("/api/v1/")?i=`http://localhost:8080${l}`:i=`${d}${l}`);const c=await fetch(i,{headers:{Authorization:`Bearer ${e}`}});if(!c.ok)throw new Error("無法載入圖片");const _=await c.blob(),L=URL.createObjectURL(_),h=window.open();h&&h.document.write(`
        <html>
          <head><title>證照預覽</title></head>
          <body style="margin:0;padding:0;background:#222;display:flex;justify-content:center;align-items:center;height:100vh;">
            <img src="${L}" style="max-width:95%;max-height:95vh;box-shadow:0 0 20px rgba(0,0,0,0.5);" />
          </body>
        </html>
      `)}catch(i){console.error("View license image error:",i),alert("無法載入圖片："+(i.message||"未知錯誤"))}};return mt(()=>{pt()}),(l,e)=>{var i,d,c,_,L,h,$,P,U,O,q,G,H,J,K,Q,X,Y,Z,tt,et,st;return r(),o("div",null,[vt(_t),t("div",bt,[t("div",ht,[t("div",ft,[(r(),o(w,null,k(ot,s=>t("button",{key:s.id,onClick:x=>v.value=s.id,class:m(["px-4 py-2 font-medium transition-colors",v.value===s.id?"text-blue-600 border-b-2 border-blue-600":"text-gray-700 hover:text-gray-900"])},a(s.label),11,wt)),64))]),v.value==="statistics"?(r(),o("div",kt,[e[8]||(e[8]=t("h2",{class:"text-3xl font-bold text-gray-800"},"系統統計報告",-1)),j.value?(r(),o("div",Ct,[...e[2]||(e[2]=[t("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"},null,-1),t("p",{class:"mt-4 text-gray-600"},"載入中...",-1)])])):n.value?(r(),o("div",Lt,[t("div",$t,[e[3]||(e[3]=t("h3",{class:"text-lg font-semibold text-blue-800 mb-2"},"用戶統計",-1)),t("div",St,a(((i=n.value.users)==null?void 0:i.total)||0),1),t("div",jt,[t("p",null,"啟用："+a(((d=n.value.users)==null?void 0:d.active)||0)+" | 停用："+a(((c=n.value.users)==null?void 0:c.inactive)||0),1),t("p",Mt," 使用者："+a(((L=(_=n.value.users)==null?void 0:_.by_role)==null?void 0:L.user)||0)+" | 照護者："+a((($=(h=n.value.users)==null?void 0:h.by_role)==null?void 0:$.caregiver)||0)+" | 管理員："+a(((U=(P=n.value.users)==null?void 0:P.by_role)==null?void 0:U.admin)||0),1)])]),t("div",Dt,[e[4]||(e[4]=t("h3",{class:"text-lg font-semibold text-green-800 mb-2"},"照護者統計",-1)),t("div",At,a(((O=n.value.caregivers)==null?void 0:O.total)||0),1),t("div",It,"啟用："+a(((q=n.value.caregivers)==null?void 0:q.active)||0),1)]),t("div",Nt,[e[5]||(e[5]=t("h3",{class:"text-lg font-semibold text-purple-800 mb-2"},"合約統計",-1)),t("div",Tt,a(((G=n.value.contracts)==null?void 0:G.total)||0),1),t("div",Bt,[t("p",null,"待處理："+a(((H=n.value.contracts)==null?void 0:H.pending)||0)+" | 進行中："+a(((J=n.value.contracts)==null?void 0:J.active)||0),1),t("p",null,"已完成："+a(((K=n.value.contracts)==null?void 0:K.completed)||0)+" | 已取消："+a(((Q=n.value.contracts)==null?void 0:Q.canceled)||0),1)])]),t("div",Vt,[e[6]||(e[6]=t("h3",{class:"text-lg font-semibold text-yellow-800 mb-2"},"證照統計",-1)),t("div",Wt,a(((X=n.value.licenses)==null?void 0:X.total)||0),1),t("div",Ft,[t("p",null,"待審核："+a(((Y=n.value.licenses)==null?void 0:Y.pending)||0)+" | 已通過："+a(((Z=n.value.licenses)==null?void 0:Z.approved)||0),1),t("p",null,"已拒絕："+a(((tt=n.value.licenses)==null?void 0:tt.rejected)||0),1)])]),t("div",Rt,[e[7]||(e[7]=t("h3",{class:"text-lg font-semibold text-indigo-800 mb-2"},"評價統計",-1)),t("div",zt,a(((et=n.value.reviews)==null?void 0:et.total)||0),1),t("div",Et," 平均評分："+a((st=n.value.reviews)!=null&&st.avg_rating?n.value.reviews.avg_rating.toFixed(1):"0.0"),1)])])):g("",!0)])):g("",!0),v.value==="users"?(r(),o("div",Pt,[t("div",{class:"flex justify-between items-center"},[e[9]||(e[9]=t("h2",{class:"text-3xl font-bold text-gray-800"},"用戶管理",-1)),t("button",{onClick:F,class:"btn-secondary"},"重新載入")]),M.value?(r(),o("div",Ut,[...e[10]||(e[10]=[t("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"},null,-1),t("p",{class:"mt-4 text-gray-600"},"載入中...",-1)])])):(r(),o("div",Ot,[t("table",qt,[e[11]||(e[11]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"ID"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"電子郵件"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"暱稱"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"角色"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"狀態"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"操作")])],-1)),t("tbody",Gt,[(r(!0),o(w,null,k(B.value,s=>(r(),o("tr",{key:s.user_id},[t("td",Ht,a(s.user_id),1),t("td",Jt,a(s.email),1),t("td",Kt,a(s.nickname||"-"),1),t("td",Qt,[t("span",{class:m([{"bg-purple-100 text-purple-800":s.role==="admin","bg-green-100 text-green-800":s.role==="caregiver","bg-blue-100 text-blue-800":s.role==="user"},"px-2 py-1 text-xs rounded-full"])},a(rt(s.role)),3)]),t("td",Xt,[t("span",{class:m([s.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800","px-2 py-1 text-xs rounded-full"])},a(s.is_active?"啟用":"停用"),3)]),t("td",Yt,[s.role!=="admin"?(r(),o("button",{key:0,onClick:x=>xt(s.user_id,!s.is_active),class:m([s.is_active?"bg-red-500 hover:bg-red-600":"bg-green-500 hover:bg-green-600","btn-secondary text-sm text-white"])},a(s.is_active?"停用":"啟用"),11,Zt)):(r(),o("span",te,"-"))])]))),128))])])]))])):g("",!0),v.value==="caregivers"?(r(),o("div",ee,[t("div",{class:"flex justify-between items-center"},[e[12]||(e[12]=t("h2",{class:"text-3xl font-bold text-gray-800"},"照護者管理",-1)),t("button",{onClick:R,class:"btn-secondary"},"重新載入")]),D.value?(r(),o("div",se,[...e[13]||(e[13]=[t("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"},null,-1),t("p",{class:"mt-4 text-gray-600"},"載入中...",-1)])])):(r(),o("div",ae,[t("table",le,[e[14]||(e[14]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"ID"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"姓名"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"電子郵件"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"電話"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"評分"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"狀態"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"操作")])],-1)),t("tbody",oe,[(r(!0),o(w,null,k(V.value,s=>{var x,y,b,f,at;return r(),o("tr",{key:s.profile_id},[t("td",re,a(s.profile_id),1),t("td",ne,a(s.full_name),1),t("td",ie,a(((x=s.user)==null?void 0:x.email)||"-"),1),t("td",de,a(s.phone||"-"),1),t("td",ce,a(s.avg_rating?s.avg_rating.toFixed(1):"0.0"),1),t("td",pe,[t("span",{class:m([(y=s.user)!=null&&y.is_active?"bg-green-100 text-green-800":"bg-red-100 text-red-800","px-2 py-1 text-xs rounded-full"])},a((b=s.user)!=null&&b.is_active?"啟用":"停用"),3)]),t("td",xe,[t("button",{onClick:Je=>{var lt;return ut(s.profile_id,!((lt=s.user)!=null&&lt.is_active))},class:m([(f=s.user)!=null&&f.is_active?"bg-red-500 hover:bg-red-600":"bg-green-500 hover:bg-green-600","btn-secondary text-sm text-white"])},a((at=s.user)!=null&&at.is_active?"停用":"啟用"),11,ue)])])}),128))])])]))])):g("",!0),v.value==="contracts"?(r(),o("div",ye,[t("div",{class:"flex justify-between items-center"},[e[15]||(e[15]=t("h2",{class:"text-3xl font-bold text-gray-800"},"合約管理",-1)),t("button",{onClick:z,class:"btn-secondary"},"重新載入")]),A.value?(r(),o("div",ge,[...e[16]||(e[16]=[t("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"},null,-1),t("p",{class:"mt-4 text-gray-600"},"載入中...",-1)])])):(r(),o("div",me,[t("table",ve,[e[17]||(e[17]=t("thead",{class:"bg-gray-50"},[t("tr",null,[t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"ID"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"使用者"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"照護者"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"開始日期"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"結束日期"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"狀態"),t("th",{class:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase"},"操作")])],-1)),t("tbody",_e,[(r(!0),o(w,null,k(W.value,s=>{var x,y;return r(),o("tr",{key:s.contract_id},[t("td",be,a(s.contract_id),1),t("td",he,a(((x=s.user)==null?void 0:x.email)||"-"),1),t("td",fe,a(((y=s.caregiver)==null?void 0:y.email)||"-"),1),t("td",we,a(C(s.start_date)),1),t("td",ke,a(C(s.end_date)),1),t("td",Ce,[t("span",{class:m([it(s.status),"px-2 py-1 text-xs rounded-full"])},a(nt(s.status)),3)]),t("td",Le,[t("select",{onChange:b=>yt(s.contract_id,b.target.value),class:"text-sm border rounded px-2 py-1"},[t("option",{value:"pending",selected:s.status==="pending"},"待處理",8,Se),t("option",{value:"active",selected:s.status==="active"},"進行中",8,je),t("option",{value:"completed",selected:s.status==="completed"},"已完成",8,Me),t("option",{value:"canceled",selected:s.status==="canceled"},"已取消",8,De)],40,$e)])])}),128))])])]))])):g("",!0),v.value==="licenses"?(r(),o("div",Ae,[t("div",Ie,[e[18]||(e[18]=t("h2",{class:"text-3xl font-bold text-gray-800"},"證照審核",-1)),t("div",Ne,[t("button",{onClick:e[0]||(e[0]=s=>N("all")),class:"btn-secondary"},"所有證照"),t("button",{onClick:e[1]||(e[1]=s=>N("pending")),class:"btn-primary"},"待審核")])]),I.value?(r(),o("div",Te,[...e[19]||(e[19]=[t("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"},null,-1),t("p",{class:"mt-4 text-gray-600"},"載入中...",-1)])])):S.value.length===0?(r(),o("div",Be," 目前沒有證照 ")):(r(),o("div",Ve,[(r(!0),o(w,null,k(S.value,s=>{var x,y,b;return r(),o("div",{key:s.license_id,class:"card"},[t("div",We,[t("div",Fe,[t("div",Re,[t("h3",ze,a(s.name),1),t("span",{class:m([ct(s.status),"px-3 py-1 rounded-full text-sm font-medium"])},a(dt(s.status)),3)]),t("div",Ee,[t("p",null,[e[20]||(e[20]=t("span",{class:"font-medium"},"照護者：",-1)),T(" "+a(((x=s.caregiver_profile)==null?void 0:x.full_name)||"-")+" ("+a(((b=(y=s.caregiver_profile)==null?void 0:y.user)==null?void 0:b.email)||"-")+") ",1)]),t("p",null,[e[21]||(e[21]=t("span",{class:"font-medium"},"發證日期：",-1)),T(a(C(s.issue_date)),1)]),t("p",null,[e[22]||(e[22]=t("span",{class:"font-medium"},"有效期限：",-1)),T(a(C(s.expiry_date)),1)]),s.proof_url?(r(),o("p",Pe,[e[23]||(e[23]=t("span",{class:"font-medium"},"證明文件：",-1)),t("button",{onClick:f=>gt(s.proof_url),class:"text-primary-600 hover:underline"}," 查看 ",8,Ue)])):g("",!0)])]),s.status==="pending"?(r(),o("div",Oe,[t("button",{onClick:f=>E(s.license_id,"approved"),class:"btn-primary bg-green-500 hover:bg-green-600 text-white"}," 通過 ",8,qe),t("button",{onClick:f=>E(s.license_id,"rejected"),class:"btn-secondary bg-red-500 hover:bg-red-600 text-white"}," 拒絕 ",8,Ge)])):g("",!0)])])}),128))]))])):g("",!0)])])])}}};export{Xe as default};
