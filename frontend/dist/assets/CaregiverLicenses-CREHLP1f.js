import{f as n,l as P,c as o,a as R,b as t,h as f,e as i,F as W,p as q,g as w,i as h,v as k,t as u,B as _,o as r,x as z}from"./index-t9rlBETP.js";import{N as A}from"./Navbar-CypzDj8e.js";const E={class:"bg-gray-50 min-h-screen"},T={class:"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-10"},U={class:"flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8"},G={key:0,class:"bg-white rounded-xl p-10 text-center shadow-sm border border-gray-100"},J={key:1,class:"bg-white rounded-xl p-10 text-center shadow-sm border border-gray-100"},O={key:2,class:"space-y-4"},H={class:"p-6"},K={class:"flex justify-between items-start"},Q={class:"flex-1"},X={class:"flex items-center space-x-3 mb-3"},Y={class:"text-lg font-semibold text-gray-800"},Z={class:"text-gray-600 space-y-1 text-sm"},ee={key:0},te=["onClick"],se=["onClick"],le={class:"flex min-h-full items-center justify-center p-4 text-center sm:p-0"},ae={class:"px-4 py-5 sm:p-6"},oe={class:"relative"},re={class:"grid grid-cols-2 gap-4"},ne={key:0,class:"text-xs text-blue-600 mt-2 text-left"},ie={key:0,class:"text-red-600 text-sm bg-red-50 p-3 rounded-md border border-red-100 flex items-center gap-2"},de={class:"bg-gray-50 px-4 py-3 sm:flex sm:flex-row-reverse sm:px-6 border-t border-gray-100"},ue=["disabled"],ce={__name:"CaregiverLicenses",setup(me){const C=n(null),v=n([]),b=n(!1),x=n(!1),a=n({name:"",issue_date:"",expiry_date:""}),m=n(null),p=n(""),c=n(!1),L=l=>l?new Date(l).toLocaleDateString("zh-TW"):"無資料",M=l=>({pending:"審核中",approved:"已核准",rejected:"已拒絕"})[l]||l,V=l=>{m.value=l.target.files[0]},g=()=>{x.value=!1,a.value={name:"",issue_date:"",expiry_date:""},m.value=null,p.value=""},$=async()=>{var l,e;if(!m.value){p.value="請選擇證明文件";return}c.value=!0,p.value="";try{const s=new FormData;s.append("name",a.value.name),s.append("issue_date",a.value.issue_date),s.append("expiry_date",a.value.expiry_date),s.append("proof",m.value),await _.uploadLicense(s),g(),y(),alert("上傳成功")}catch(s){p.value=((e=(l=s.response)==null?void 0:l.data)==null?void 0:e.error)||s.message||"上傳失敗"}finally{c.value=!1}},N=async l=>{var e,s;if(confirm("確定要刪除此證照嗎？"))try{await _.deleteLicense(l),y(),alert("刪除成功")}catch(d){alert("刪除失敗："+(((s=(e=d.response)==null?void 0:e.data)==null?void 0:s.error)||d.message))}},B=async l=>{if(!l)return;const e=localStorage.getItem("token");if(!e){alert("請先登入");return}try{let s=l;const d="/api/v1";if(l.startsWith("/uploads/licenses/")){const S=l.replace("/uploads/licenses/","");s=`${d}/caregivers/licenses/image/${S}`}else l.startsWith("http")||(l.startsWith("/api/v1/")?s=`http://localhost:8080${l}`:s=`${d}${l}`);const j=await fetch(s,{headers:{Authorization:`Bearer ${e}`}});if(!j.ok)throw new Error("無法載入圖片");const F=await j.blob(),I=URL.createObjectURL(F),D=window.open();D&&D.document.write(`
        <html>
          <head><title>證照預覽</title></head>
          <body style="margin:0;padding:0;background:#222;display:flex;justify-content:center;align-items:center;height:100vh;">
            <img src="${I}" style="max-width:95%;max-height:95vh;box-shadow:0 0 20px rgba(0,0,0,0.5);" />
          </body>
        </html>
      `)}catch(s){console.error("View license image error:",s),alert("無法載入圖片："+(s.message||"未知錯誤"))}},y=async()=>{var l,e;b.value=!0;try{v.value=await _.getMyLicenses()}catch(s){console.error("Load licenses error:",s),alert("載入失敗："+(((e=(l=s.response)==null?void 0:l.data)==null?void 0:e.error)||s.message))}finally{b.value=!1}};return P(()=>{y()}),(l,e)=>(r(),o("div",null,[R(A),t("div",E,[t("div",T,[t("div",U,[e[8]||(e[8]=t("div",null,[t("h2",{class:"text-3xl font-bold text-gray-900"},"專業證照管理"),t("p",{class:"text-gray-500 mt-1"},"上傳並管理您的專業資格證明，提升案主信任度。")],-1)),t("button",{onClick:e[0]||(e[0]=s=>x.value=!0),class:"bg-blue-600 hover:bg-blue-700 text-white px-5 py-2.5 rounded-lg shadow-md hover:shadow-lg transition-all flex items-center gap-2 font-medium"},[...e[7]||(e[7]=[t("i",{class:"fa-solid fa-plus"},null,-1),i(" 上傳新證照 ",-1)])])]),b.value?(r(),o("div",G,[...e[9]||(e[9]=[t("div",{class:"inline-block animate-spin rounded-full h-10 w-10 border-4 border-gray-200 border-t-blue-600"},null,-1),t("p",{class:"mt-4 text-gray-500 font-medium"},"資料載入中...",-1)])])):v.value.length===0?(r(),o("div",J,[e[10]||(e[10]=t("i",{class:"fa-solid fa-file-circle-question text-4xl text-gray-400 mb-4"},null,-1)),e[11]||(e[11]=t("p",{class:"text-gray-600"},"尚無證照",-1)),t("button",{onClick:e[1]||(e[1]=s=>x.value=!0),class:"mt-4 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg"}," 立即上傳 ")])):(r(),o("div",O,[(r(!0),o(W,null,q(v.value,s=>(r(),o("div",{key:s.license_id,class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},[t("div",H,[t("div",K,[t("div",Q,[t("div",X,[t("h3",Y,u(s.name),1),t("span",{class:z([{"bg-yellow-100 text-yellow-800":s.status==="pending","bg-green-100 text-green-800":s.status==="approved","bg-red-100 text-red-800":s.status==="rejected"},"px-3 py-1 rounded-full text-sm font-medium"])},u(M(s.status)),3)]),t("div",Z,[t("p",null,[e[12]||(e[12]=t("span",{class:"font-medium"},"發證日期：",-1)),i(u(L(s.issue_date)),1)]),t("p",null,[e[13]||(e[13]=t("span",{class:"font-medium"},"有效期限：",-1)),i(u(L(s.expiry_date)),1)]),s.proof_url?(r(),o("p",ee,[e[14]||(e[14]=t("span",{class:"font-medium"},"證明文件：",-1)),t("button",{onClick:d=>B(s.proof_url),class:"text-primary-600 hover:underline"}," 查看 ",8,te)])):f("",!0)])]),t("button",{onClick:d=>N(s.license_id),class:"text-gray-400 hover:text-red-500 hover:bg-red-50 p-2 rounded-full transition-colors ml-4",title:"刪除"},[...e[15]||(e[15]=[t("i",{class:"fa-solid fa-trash-can"},null,-1)])],8,se)])])]))),128))]))]),x.value?(r(),o("div",{key:0,class:"fixed inset-0 z-50 overflow-y-auto",onClick:w(g,["self"])},[e[26]||(e[26]=t("div",{class:"fixed inset-0 bg-gray-600 bg-opacity-50 transition-opacity"},null,-1)),t("div",le,[t("div",{class:"relative transform overflow-hidden rounded-2xl bg-white text-left shadow-xl transition-all sm:my-8 sm:w-full sm:max-w-lg",onClick:e[6]||(e[6]=w(()=>{},["stop"]))},[t("div",{class:"bg-gray-50 px-4 py-3 sm:px-6 border-b border-gray-100 flex justify-between items-center"},[e[17]||(e[17]=t("h3",{class:"text-lg font-semibold leading-6 text-gray-900 flex items-center gap-2"},[t("i",{class:"fa-solid fa-file-circle-plus text-blue-600"}),i(" 上傳證照 ")],-1)),t("button",{onClick:g,class:"text-gray-400 hover:text-gray-600 transition-colors"},[...e[16]||(e[16]=[t("i",{class:"fa-solid fa-xmark text-xl"},null,-1)])])]),t("div",ae,[t("form",{onSubmit:w($,["prevent"]),class:"space-y-5"},[t("div",null,[e[19]||(e[19]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1.5"},[i(" 證照名稱 "),t("span",{class:"text-red-500"},"*")],-1)),t("div",oe,[e[18]||(e[18]=t("span",{class:"absolute left-3 top-2.5 text-gray-400"},[t("i",{class:"fa-solid fa-id-card"})],-1)),h(t("input",{"onUpdate:modelValue":e[2]||(e[2]=s=>a.value.name=s),type:"text",required:"",class:"input-field pl-10",placeholder:"例如：照顧服務員技術士證"},null,512),[[k,a.value.name]])])]),t("div",re,[t("div",null,[e[20]||(e[20]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1.5"},[i(" 發證日期 "),t("span",{class:"text-red-500"},"*")],-1)),h(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>a.value.issue_date=s),type:"date",required:"",class:"input-field text-gray-600"},null,512),[[k,a.value.issue_date]])]),t("div",null,[e[21]||(e[21]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1.5"},[i(" 有效期限 "),t("span",{class:"text-red-500"},"*")],-1)),h(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>a.value.expiry_date=s),type:"date",required:"",class:"input-field text-gray-600"},null,512),[[k,a.value.expiry_date]])])]),t("div",null,[e[24]||(e[24]=t("label",{class:"block text-sm font-medium text-gray-700 mb-1.5"},"證明文件",-1)),t("div",{class:"relative border border-dashed border-gray-300 rounded-lg p-4 bg-gray-50 hover:bg-gray-100 transition-colors text-center cursor-pointer",onClick:e[5]||(e[5]=()=>{var s;return(s=C.value)==null?void 0:s.click()})},[t("input",{ref_key:"fileInputRef",ref:C,type:"file",accept:"image/*,.pdf",class:"hidden",onChange:V},null,544),e[22]||(e[22]=t("div",{class:"text-gray-500"},[t("i",{class:"fa-solid fa-cloud-arrow-up text-2xl mb-2 text-gray-400"}),t("p",{class:"text-sm font-medium"},"點擊或拖曳檔案至此"),t("p",{class:"text-xs text-gray-400 mt-1"},"支援圖片 (JPG, PNG) 或 PDF 格式")],-1))]),m.value?(r(),o("div",ne,[e[23]||(e[23]=t("i",{class:"fa-solid fa-check mr-1"},null,-1)),i(" 已選擇: "+u(m.value.name),1)])):f("",!0)]),p.value?(r(),o("div",ie,[e[25]||(e[25]=t("i",{class:"fa-solid fa-circle-exclamation"},null,-1)),t("span",null,u(p.value),1)])):f("",!0)],32)]),t("div",de,[t("button",{onClick:$,disabled:c.value,class:"w-full inline-flex justify-center rounded-lg bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm hover:bg-blue-500 sm:ml-3 sm:w-auto transition-colors disabled:opacity-50"},u(c.value?"上傳中...":"確認上傳"),9,ue),t("button",{onClick:g,class:"mt-3 inline-flex w-full justify-center rounded-lg bg-white px-3 py-2 text-sm font-semibold text-gray-900 shadow-sm ring-1 ring-inset ring-gray-300 hover:bg-gray-50 sm:mt-0 sm:w-auto transition-colors"}," 取消 ")])])])])):f("",!0)])]))}};export{ce as default};
