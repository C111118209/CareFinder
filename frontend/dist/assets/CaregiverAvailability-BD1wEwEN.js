import{f as m,l as M,c as i,a as T,b as e,d as h,e as k,h as V,F as S,p as C,t as f,s as g,o,i as r,m as A,v as c,x as D}from"./index-t9rlBETP.js";import{_ as F,N as $}from"./Navbar-CypzDj8e.js";const z={class:"bg-gray-50 min-h-screen"},P={class:"max-w-5xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-8"},W={class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},G={class:"p-6"},H={key:0,class:"text-center py-8 text-gray-400"},J={key:1,class:"space-y-3"},K={class:"w-full md:w-auto md:flex-1 grid grid-cols-2 md:grid-cols-4 gap-3 items-center"},O={class:"col-span-2 md:col-span-1"},Q={class:"relative"},R=["onUpdate:modelValue"],X={class:"md:col-span-3 flex items-center gap-2"},Y={class:"flex-1"},Z=["onUpdate:modelValue"],ee={class:"flex-1"},te=["onUpdate:modelValue"],ae={class:"w-full md:w-auto flex justify-end md:border-l md:pl-3 border-gray-100"},se=["onClick"],le={key:2,class:"text-red-600 text-sm mt-4 bg-red-50 p-3 rounded-md border border-red-100"},de={class:"flex justify-end space-x-3 mt-6 pt-4 border-t border-gray-100"},ie=["disabled"],oe={class:"bg-white rounded-xl shadow-sm border border-gray-200 overflow-hidden"},re={class:"p-6"},ne={key:0,class:"text-center py-8 text-gray-400"},ue={key:1,class:"space-y-3"},me={class:"w-full md:w-auto md:flex-1 grid grid-cols-2 md:grid-cols-10 gap-3 items-center"},ce={class:"col-span-2 md:col-span-3"},be=["onUpdate:modelValue"],pe={class:"col-span-2 md:col-span-4 flex items-center gap-2"},ve={class:"flex-1"},xe=["onUpdate:modelValue"],_e={class:"flex-1"},fe=["onUpdate:modelValue"],ge={class:"col-span-2 md:col-span-3"},ye=["onUpdate:modelValue"],we={class:"w-full md:w-auto flex justify-end md:border-l md:pl-3 border-gray-100"},he=["onClick"],ke={key:2,class:"text-red-600 text-sm mt-4 bg-red-50 p-3 rounded-md border border-red-100"},Ve={class:"flex justify-end space-x-3 mt-6 pt-4 border-t border-gray-100"},Se=["disabled"],Ce={__name:"CaregiverAvailability",setup(Ae){const n=m([]),u=m([]),b=m(""),p=m(""),v=m(!1),x=m(!1);let _=0;const U=()=>{n.value.push({id:_++,day_of_week:"",start_time:"",end_time:""})},q=l=>{n.value.splice(l,1)},N=()=>{u.value.push({id:_++,date:"",start_time:"",end_time:"",is_available:!0})},j=l=>{u.value.splice(l,1)},E=async()=>{var t,a;b.value="";const l=n.value.filter(s=>s.day_of_week&&s.start_time&&s.end_time).map(s=>{if(s.start_time>=s.end_time)throw new Error("開始時間必須早於結束時間");return{day_of_week:parseInt(s.day_of_week),start_time:s.start_time,end_time:s.end_time}});v.value=!0;try{await g.updateAvailability(l),await y(),alert("每週服務時間已更新！")}catch(s){b.value=((a=(t=s.response)==null?void 0:t.data)==null?void 0:a.error)||s.message||"儲存失敗"}finally{v.value=!1}},I=async()=>{var t,a;p.value="";const l=u.value.filter(s=>s.date&&s.start_time&&s.end_time).map(s=>{if(s.start_time>=s.end_time)throw new Error("開始時間必須早於結束時間");return{date:s.date,start_time:s.start_time,end_time:s.end_time,is_available:s.is_available}});x.value=!0;try{await g.updateSpecialAvailability(l),await w(),alert("特殊時段已更新！")}catch(s){p.value=((a=(t=s.response)==null?void 0:t.data)==null?void 0:a.error)||s.message||"儲存失敗"}finally{x.value=!1}},y=async()=>{try{const l=await g.getAvailability(),t=l.availabilities||l||[];n.value=t.map(a=>({id:_++,day_of_week:a.day_of_week||a.day_of_week,start_time:a.start_time||"",end_time:a.end_time||""}))}catch(l){console.error("載入失敗:",l)}},w=async()=>{try{const l=await g.getSpecialAvailability(),t=l.special_availabilities||l||[];u.value=t.map(a=>{const s=a.date?typeof a.date=="string"?a.date.split("T")[0]:a.date:"";return{id:_++,date:s,start_time:a.start_time||"",end_time:a.end_time||"",is_available:a.is_available!==void 0?a.is_available:!0}})}catch(l){console.error("載入特殊時段失敗:",l)}},B=()=>{y()},L=()=>{w()};return M(()=>{y(),w()}),(l,t)=>(o(),i("div",null,[T($),e("div",z,[e("div",P,[t[20]||(t[20]=e("header",{class:"mb-8"},[e("h2",{class:"text-3xl font-bold text-gray-900"},"服務時間管理"),e("p",{class:"text-gray-500 mt-2"},"設定您的每週固定行程與特殊日期的排程，讓案主更容易預約。")],-1)),e("div",W,[e("div",{class:"px-6 py-4 bg-blue-50 border-b border-blue-100 flex justify-between items-center"},[t[1]||(t[1]=h('<div class="flex items-center gap-3" data-v-452e6dba><div class="bg-blue-100 p-2 rounded-full text-blue-600" data-v-452e6dba><i class="fa-solid fa-calendar-week" data-v-452e6dba></i></div><div data-v-452e6dba><h3 class="text-lg font-bold text-gray-800" data-v-452e6dba>每週固定時間</h3><p class="text-xs text-blue-600/80" data-v-452e6dba>例行性的服務時間</p></div></div>',1)),e("button",{onClick:U,class:"text-sm bg-white border border-blue-200 text-blue-600 px-3 py-1.5 rounded-lg hover:bg-blue-50 transition-colors shadow-sm"},[...t[0]||(t[0]=[e("i",{class:"fa-solid fa-plus mr-1"},null,-1),k(" 新增時段 ",-1)])])]),e("div",G,[n.value.length===0?(o(),i("div",H,[...t[2]||(t[2]=[e("i",{class:"fa-regular fa-calendar-xmark text-4xl mb-2 opacity-50"},null,-1),e("p",null,"尚未設定每週時間",-1)])])):(o(),i("div",J,[(o(!0),i(S,null,C(n.value,(a,s)=>(o(),i("div",{key:a.id,class:"slot-card group flex flex-wrap md:flex-nowrap items-center gap-3 p-3 bg-white border border-gray-200 rounded-lg hover:border-blue-300"},[e("div",K,[e("div",O,[t[5]||(t[5]=e("label",{class:"block text-xs text-gray-500 md:hidden mb-1"},"星期",-1)),e("div",Q,[t[4]||(t[4]=e("i",{class:"fa-solid fa-calendar absolute left-2 top-2.5 text-gray-400 text-sm"},null,-1)),r(e("select",{"onUpdate:modelValue":d=>a.day_of_week=d,class:"input-mini pl-7 bg-gray-50 focus:bg-white focus:ring-1 focus:ring-blue-500 w-full",required:""},[...t[3]||(t[3]=[e("option",{value:""},"選擇星期",-1),e("option",{value:1},"週一",-1),e("option",{value:2},"週二",-1),e("option",{value:3},"週三",-1),e("option",{value:4},"週四",-1),e("option",{value:5},"週五",-1),e("option",{value:6},"週六",-1),e("option",{value:7},"週日",-1)])],8,R),[[A,a.day_of_week]])])]),e("div",X,[e("div",Y,[t[6]||(t[6]=e("label",{class:"block text-xs text-gray-500 md:hidden mb-1"},"開始",-1)),r(e("input",{"onUpdate:modelValue":d=>a.start_time=d,type:"time",class:"input-mini w-full",required:""},null,8,Z),[[c,a.start_time]])]),t[8]||(t[8]=e("span",{class:"text-gray-400 mt-5 md:mt-0"},[e("i",{class:"fa-solid fa-arrow-right text-xs"})],-1)),e("div",ee,[t[7]||(t[7]=e("label",{class:"block text-xs text-gray-500 md:hidden mb-1"},"結束",-1)),r(e("input",{"onUpdate:modelValue":d=>a.end_time=d,type:"time",class:"input-mini w-full",required:""},null,8,te),[[c,a.end_time]])])])]),e("div",ae,[e("button",{onClick:d=>q(s),class:"text-gray-400 hover:text-red-500 hover:bg-red-50 p-2 rounded-full transition-colors",title:"刪除"},[...t[9]||(t[9]=[e("i",{class:"fa-solid fa-trash-can"},null,-1)])],8,se)])]))),128))])),b.value?(o(),i("div",le,f(b.value),1)):V("",!0),e("div",de,[e("button",{onClick:B,class:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg text-sm"}," 取消變更 "),e("button",{onClick:E,disabled:v.value,class:"bg-blue-600 hover:bg-blue-700 text-white px-5 py-2 rounded-lg text-sm font-medium shadow-sm transition-all"},f(v.value?"儲存中...":"儲存設定"),9,ie)])])]),e("div",oe,[e("div",{class:"px-6 py-4 bg-amber-50 border-b border-amber-100 flex justify-between items-center"},[t[11]||(t[11]=h('<div class="flex items-center gap-3" data-v-452e6dba><div class="bg-amber-100 p-2 rounded-full text-amber-600" data-v-452e6dba><i class="fa-solid fa-calendar-day" data-v-452e6dba></i></div><div data-v-452e6dba><h3 class="text-lg font-bold text-gray-800" data-v-452e6dba>特殊日期設定</h3><p class="text-xs text-amber-600/80" data-v-452e6dba>優先權高於每週時間（如：國定假日、臨時請假）</p></div></div>',1)),e("button",{onClick:N,class:"text-sm bg-white border border-amber-200 text-amber-600 px-3 py-1.5 rounded-lg hover:bg-amber-50 transition-colors shadow-sm"},[...t[10]||(t[10]=[e("i",{class:"fa-solid fa-plus mr-1"},null,-1),k(" 新增日期 ",-1)])])]),e("div",re,[u.value.length===0?(o(),i("div",ne,[...t[12]||(t[12]=[e("i",{class:"fa-solid fa-mug-hot text-4xl mb-2 opacity-50"},null,-1),e("p",null,"無特殊排程",-1)])])):(o(),i("div",ue,[(o(!0),i(S,null,C(u.value,(a,s)=>(o(),i("div",{key:a.id,class:"slot-card group flex flex-wrap md:flex-nowrap items-center gap-3 p-3 bg-white border border-gray-200 rounded-lg hover:border-amber-300 border-l-4 border-l-amber-400"},[e("div",me,[e("div",ce,[t[13]||(t[13]=e("label",{class:"block text-xs text-gray-500 md:hidden mb-1"},"日期",-1)),r(e("input",{"onUpdate:modelValue":d=>a.date=d,type:"date",class:"input-mini bg-gray-50 focus:bg-white w-full",required:""},null,8,be),[[c,a.date]])]),e("div",pe,[e("div",ve,[t[14]||(t[14]=e("label",{class:"block text-xs text-gray-500 md:hidden mb-1"},"開始",-1)),r(e("input",{"onUpdate:modelValue":d=>a.start_time=d,type:"time",class:"input-mini w-full",required:""},null,8,xe),[[c,a.start_time]])]),t[16]||(t[16]=e("span",{class:"text-gray-400 mt-5 md:mt-0"},[e("i",{class:"fa-solid fa-arrow-right text-xs"})],-1)),e("div",_e,[t[15]||(t[15]=e("label",{class:"block text-xs text-gray-500 md:hidden mb-1"},"結束",-1)),r(e("input",{"onUpdate:modelValue":d=>a.end_time=d,type:"time",class:"input-mini w-full",required:""},null,8,fe),[[c,a.end_time]])])]),e("div",ge,[t[18]||(t[18]=e("label",{class:"block text-xs text-gray-500 md:hidden mb-1"},"狀態",-1)),r(e("select",{"onUpdate:modelValue":d=>a.is_available=d,class:D(["input-mini w-full",a.is_available?"text-green-600 font-medium":"text-red-500 font-medium"]),required:""},[...t[17]||(t[17]=[e("option",{value:!0},"✅ 可服務",-1),e("option",{value:!1},"⛔ 不可服務",-1)])],10,ye),[[A,a.is_available]])])]),e("div",we,[e("button",{onClick:d=>j(s),class:"text-gray-400 hover:text-red-500 hover:bg-red-50 p-2 rounded-full transition-colors",title:"刪除"},[...t[19]||(t[19]=[e("i",{class:"fa-solid fa-trash-can"},null,-1)])],8,he)])]))),128))])),p.value?(o(),i("div",ke,f(p.value),1)):V("",!0),e("div",Ve,[e("button",{onClick:L,class:"px-4 py-2 text-gray-600 hover:bg-gray-100 rounded-lg text-sm"}," 取消變更 "),e("button",{onClick:I,disabled:x.value,class:"bg-amber-500 hover:bg-amber-600 text-white px-5 py-2 rounded-lg text-sm font-medium shadow-sm transition-all"},f(x.value?"儲存中...":"儲存特殊時段"),9,Se)])])])])])]))}},Ne=F(Ce,[["__scopeId","data-v-452e6dba"]]);export{Ne as default};
